<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Sharewise App - Free online expense splitter and bill tracker. Easily split bills, track shared expenses, and calculate who owes whom. Perfect for roommates, friends, and group trips.">
  <meta name="keywords" content="expense splitter, bill splitter, split bills, expense tracker, shared expenses, roommate bills, group expenses, cost splitter, who owes whom">
  <meta name="author" content="Sharewise">
  <meta name="robots" content="index, follow">
  <meta name="language" content="English">
  
  <!-- Open Graph Tags for Social Sharing -->
  <meta property="og:title" content="Sharewise App - Free Expense Splitter & Bill Tracker">
  <meta property="og:description" content="Split bills effortlessly with Sharewise. Track shared expenses with friends, roommates, and family. See who owes whom and settle up easily.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://darshanleads09.github.io/sharewise-app/">
  <meta property="og:site_name" content="Sharewise App">
  
  <!-- Twitter Card Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Sharewise App - Free Expense Splitter">
  <meta name="twitter:description" content="Easily split bills and track shared expenses with friends and roommates.">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://darshanleads09.github.io/sharewise-app/">
  
  <!-- Additional SEO Meta Tags -->
  <meta name="theme-color" content="#007bff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <title>Sharewise App - Free Online Expense Splitter & Bill Tracker</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Google Site Verification -->
  <meta name="google-site-verification" content="google1b84e3765a3bbb6d" />
  
  <!-- Google Tag Manager (GTM) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX', {
      'anonymize_ip': true,
      'allow_google_signals': true,
      'allow_ad_personalization_signals': true
    });
  </script>
  
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXXXX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <!-- Schema.org Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Sharewise App",
    "description": "Free online expense splitter and bill tracker for splitting costs with friends and roommates",
    "url": "https://darshanleads09.github.io/sharewise-app/",
    "applicationCategory": "FinanceApplication",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Organization",
      "name": "Sharewise"
    },
    "featureList": [
      "Split bills with multiple people",
      "Track shared expenses",
      "Calculate who owes whom",
      "Export and import expense data",
      "Share expense data via link or file"
    ]
  }
  </script>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXXXXXX" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
  <div class="container mt-5">
    <h1 class="text-center mb-4">Sharewise App - Free Expense Splitter & Bill Tracker</h1>
    <p class="text-center text-muted mb-4">Easily split bills, track shared expenses, and see who owes whom - perfect for roommates, friends, and group trips</p>
    
    <div class="row">
      <div class="col-md-4">
        <h2 class="h4">Add User</h2>
        <p class="small text-muted">Add people to track expenses with</p>
        <form id="addUserForm">
          <div class="mb-3">
            <input type="text" id="userName" class="form-control" placeholder="Enter user name" required />
          </div>
          <button type="submit" class="btn btn-primary w-100">Add User</button>
        </form>
        <h2 class="h4 mt-4">Users List</h2>
        <ul id="userList" class="list-group"></ul>
      </div>

      <div class="col-md-8">
        <h2 class="h4">Add Expense</h2>
        <p class="small text-muted">Record shared expenses and choose who to split them with</p>
        <form id="addExpenseForm">
          <div class="mb-3">
            <label for="expenseDescription" class="form-label">Expense Description</label>
            <input type="text" id="expenseDescription" class="form-control" placeholder="e.g., Dinner, groceries, rent" required />
          </div>
          <div class="mb-3">
            <label for="expenseAmount" class="form-label">Amount</label>
            <input type="number" id="expenseAmount" class="form-control" placeholder="0.00" step="0.01" required />
          </div>
          <div class="mb-3">
            <label for="expensePaidBy" class="form-label">Paid by</label>
            <select id="expensePaidBy" class="form-select" required>
              <option value="" disabled selected>Paid by</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="expenseSplitAmong" class="form-label">Split among (hold Ctrl/Cmd to select multiple)</label>
            <select id="expenseSplitAmong" class="form-control" multiple required size="5">
              <option value="" disabled>-- Select users to split --</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success w-100">Add Expense</button>
        </form>
        
        <h2 class="h4 mt-4">Expenses</h2>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Description</th>
                <th>Amount</th>
                <th>Paid By</th>
                <th>Split Among</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="expenseList"></tbody>
          </table>
        </div>
        
        <h2 class="h4 mt-4">Current Balances</h2>
        <p class="small text-muted">How much each person has paid or owes</p>
        <ul id="balances" class="list-group"></ul>
        
        <h2 class="h4 mt-4">Settlement Summary - Who Owes Whom</h2>
        <p class="small text-muted">Optimized transactions to settle all debts</p>
        <ul id="userOwesList" class="list-group"></ul>
        
        <h2 class="h4 mt-4">Share & Import Expenses</h2>
        <p class="small text-muted">Share your expense data with others or import shared data</p>
        <div class="btn-group-vertical w-100" role="group">
          <button id="shareButton" class="btn btn-primary mb-2">
            <i class="fas fa-share-alt"></i> Share via Link
          </button>
          <button id="copyCodeButton" class="btn btn-info mb-2">
            <i class="fas fa-copy"></i> Copy Share Code
          </button>
          <button id="importCodeButton" class="btn btn-warning mb-2">
            <i class="fas fa-download"></i> Import Share Code
          </button>
          <button id="exportButton" class="btn btn-success mb-2">
            <i class="fas fa-file-export"></i> Export to File
          </button>
          <button id="importButton" class="btn btn-secondary mb-2">
            <i class="fas fa-file-import"></i> Import from File
          </button>
          <input type="file" id="fileInput" accept=".json" style="display: none;" />
        </div>
      </div>
    </div>
  </div>

  <footer class="text-center mt-5 py-4 border-top">
    <p class="text-muted small">Sharewise App - Free expense splitter and bill tracker for roommates, friends, and group trips.<br>This app is independently developed and is not affiliated with or endorsed by any expense tracking company. All rights reserved by the respective owners.</p>
  </footer>

  <script>
    $(document).ready(() => {
      // Load data from localStorage if available
      const users = JSON.parse(localStorage.getItem('sharewise_users') || '[]');
      const expenses = JSON.parse(localStorage.getItem('sharewise_expenses') || '[]');

      // Save data to localStorage
      const saveToLocalStorage = () => {
        localStorage.setItem('sharewise_users', JSON.stringify(users));
        localStorage.setItem('sharewise_expenses', JSON.stringify(expenses));
      };

      const updateUI = () => {
        $("#userList").empty();
        $("#expenseList").empty();
        $("#balances").empty();
        $("#userOwesList").empty();

        users.forEach((user, index) => {
          $("#userList").append(`
            <li class='list-group-item d-flex justify-content-between align-items-center'>
              ${user}
              <span>
                <button class='btn btn-sm btn-primary edit-user' data-index='${index}'>
                  <i class='fas fa-edit'></i>
                </button>
                <button class='btn btn-sm btn-danger delete-user' data-index='${index}'>
                  <i class='fas fa-trash'></i>
                </button>
              </span>
            </li>
          `);
        });

        expenses.forEach((expense, index) => {
          $("#expenseList").append(`
            <tr data-index='${index}'>
              <td>${expense.description}</td>
              <td>₹${expense.amount.toFixed(2)}</td>
              <td>${expense.paidBy}</td>
              <td>${expense.splitAmong.join(', ')}</td>
              <td>
                <button class='btn btn-sm btn-primary edit-expense'>
                  <i class='fas fa-edit'></i>
                </button>
                <button class='btn btn-sm btn-danger delete-expense'>
                  <i class='fas fa-trash'></i>
                </button>
              </td>
            </tr>
          `);
        });

        const balances = {};
        users.forEach(user => {
          balances[user] = 0;
        });

        expenses.forEach(expense => {
          const splitAmount = expense.amount / expense.splitAmong.length;
          expense.splitAmong.forEach(person => {
            if (person !== expense.paidBy) {
              balances[expense.paidBy] += splitAmount;
              balances[person] -= splitAmount;
            }
          });
        });

        Object.entries(balances).forEach(([user, balance]) => {
          const balanceClass = balance > 0 ? 'text-success' : balance < 0 ? 'text-danger' : 'text-muted';
          const balanceText = balance > 0 ? `gets back ₹${balance.toFixed(2)}` : balance < 0 ? `owes ₹${Math.abs(balance).toFixed(2)}` : 'settled up';
          $("#balances").append(`<li class='list-group-item d-flex justify-content-between'><span>${user}</span><span class='${balanceClass} font-weight-bold'>${balanceText}</span></li>`);
        });

        // Create optimized settlements using a greedy algorithm
        const settlements = [];
        const balancesCopy = { ...balances };
        
        // Get people who owe and who are owed
        const debtors = Object.entries(balancesCopy).filter(([_, bal]) => bal < 0).sort((a, b) => a[1] - b[1]);
        const creditors = Object.entries(balancesCopy).filter(([_, bal]) => bal > 0).sort((a, b) => b[1] - a[1]);
        
        let i = 0, j = 0;
        
        while (i < debtors.length && j < creditors.length) {
          const [debtor, debtAmount] = debtors[i];
          const [creditor, creditAmount] = creditors[j];
          
          const settleAmount = Math.min(-debtAmount, creditAmount);
          
          if (settleAmount > 0.01) { // Ignore amounts less than 1 paisa
            settlements.push({ from: debtor, to: creditor, amount: settleAmount });
            
            debtors[i][1] += settleAmount;
            creditors[j][1] -= settleAmount;
          }
          
          if (Math.abs(debtors[i][1]) < 0.01) i++;
          if (Math.abs(creditors[j][1]) < 0.01) j++;
        }

        settlements.forEach(settlement => {
          $("#userOwesList").append(`<li class='list-group-item'><strong>${settlement.from}</strong> owes <strong>${settlement.to}</strong>: <span class='text-success'>₹${settlement.amount.toFixed(2)}</span></li>`);
        });

        populateDropdowns();
      };

      // === SHARING FUNCTIONS ===
      
      // Encode data to Base64
      const encodeData = () => {
        const data = { users, expenses };
        return btoa(encodeURIComponent(JSON.stringify(data)));
      };
      
      // Decode data from Base64
      const decodeData = (encoded) => {
        try {
          return JSON.parse(decodeURIComponent(atob(encoded)));
        } catch (e) {
          console.error('Failed to decode data:', e);
          return null;
        }
      };
      
      // Generate shareable link with URL hash
      const generateShareLink = () => {
        if (users.length === 0 || expenses.length === 0) {
          alert('Please add at least one user and one expense before sharing.');
          return;
        }
        
        const encoded = encodeData();
        const baseUrl = window.location.origin + window.location.pathname;
        const shareUrl = `${baseUrl}#${encoded}`;
        
        // Check URL length
        if (shareUrl.length > 2000) {
          alert('Too much data for URL sharing! Please use "Export to File" instead.');
          return;
        }
        
        // iOS-compatible clipboard handling
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(shareUrl).then(() => {
            alert('✅ Share link copied to clipboard!\n\nPaste and send this link to anyone.\nThey can click it to view your calculations.');
          }).catch((err) => {
            console.error('Clipboard error:', err);
            // Fallback for iOS
            const textArea = document.createElement('textarea');
            textArea.value = shareUrl;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
              document.execCommand('copy');
              alert('✅ Share link copied!\n\nPaste and send this link to anyone.');
            } catch (e) {
              prompt('Copy this link to share:', shareUrl);
            }
            document.body.removeChild(textArea);
          });
        } else {
          // Fallback for older browsers
          prompt('Copy this link to share:', shareUrl);
        }
      };
      
      // Copy share code
      const copyShareCode = () => {
        if (users.length === 0 || expenses.length === 0) {
          alert('Please add at least one user and one expense before sharing.');
          return;
        }
        
        const encoded = encodeData();
        
        // iOS-compatible clipboard handling
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(encoded).then(() => {
            alert('✅ Share code copied to clipboard!\n\nSend this code to anyone.\nThey can use "Import Share Code" to load it.');
          }).catch((err) => {
            console.error('Clipboard error:', err);
            // Fallback for iOS
            const textArea = document.createElement('textarea');
            textArea.value = encoded;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
              document.execCommand('copy');
              alert('✅ Share code copied!');
            } catch (e) {
              prompt('Copy this share code:', encoded);
            }
            document.body.removeChild(textArea);
          });
        } else {
          prompt('Copy this share code:', encoded);
        }
      };
      
      // Import share code
      const importShareCode = () => {
        const code = prompt('Paste the share code you received:');
        if (!code) return;
        
        const data = decodeData(code);
        if (!data || !data.users || !data.expenses) {
          alert('❌ Invalid share code. Please check and try again.');
          return;
        }
        
        if (confirm(`This will replace your current data with:\n\n${data.users.length} users\n${data.expenses.length} expenses\n\nContinue?`)) {
          users.length = 0;
          expenses.length = 0;
          users.push(...data.users);
          expenses.push(...data.expenses);
          saveToLocalStorage();
          updateUI();
          alert('✅ Data imported successfully!');
        }
      };
      
      // Export to JSON file
      const exportToFile = () => {
        if (users.length === 0 || expenses.length === 0) {
          alert('Please add at least one user and one expense before exporting.');
          return;
        }
        
        const data = { users, expenses };
        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `sharewise-expenses-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        alert('✅ File downloaded! Share this file with others.');
      };
      
      // Import from JSON file
      const importFromFile = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            if (!data.users || !data.expenses) {
              alert('❌ Invalid file format.');
              return;
            }
            
            if (confirm(`This will replace your current data with:\n\n${data.users.length} users\n${data.expenses.length} expenses\n\nContinue?`)) {
              users.length = 0;
              expenses.length = 0;
              users.push(...data.users);
              expenses.push(...data.expenses);
              saveToLocalStorage();
              updateUI();
              alert('✅ Data imported successfully!');
            }
          } catch (err) {
            alert('❌ Error reading file: ' + err.message);
          }
          // Reset file input
          event.target.value = '';
        };
        reader.readAsText(file);
      };
      
      // Load shared data from URL hash
      const loadSharedData = () => {
        try {
          // Get hash from both window.location.hash and window.location.href for iOS compatibility
          let hash = window.location.hash.substring(1);
          
          // Fallback for iOS Chrome that might not read hash correctly
          if (!hash) {
            const href = window.location.href;
            const hashIndex = href.indexOf('#');
            if (hashIndex !== -1) {
              hash = href.substring(hashIndex + 1);
            }
          }
          
          console.log('Hash detected:', hash ? 'Yes' : 'No', 'Length:', hash.length);
          
          if (hash && hash.length > 10) {
            const data = decodeData(hash);
            console.log('Decoded data:', data ? 'Success' : 'Failed');
            
            if (data && data.users && data.expenses) {
              // For iOS, use setTimeout to avoid blocking
              setTimeout(() => {
                const shouldLoad = confirm(`Load shared data?\n\n${data.users.length} users\n${data.expenses.length} expenses\n\nThis will replace your current data.`);
                
                if (shouldLoad) {
                  users.length = 0;
                  expenses.length = 0;
                  users.push(...data.users);
                  expenses.push(...data.expenses);
                  saveToLocalStorage();
                  updateUI();
                  
                  // Clear hash after loading - iOS safe method
                  try {
                    window.history.replaceState({}, document.title, window.location.pathname);
                  } catch (e) {
                    console.error('History API error:', e);
                  }
                  
                  alert('✅ Shared data loaded successfully!');
                } else {
                  // Clear hash if user cancels
                  try {
                    window.history.replaceState({}, document.title, window.location.pathname);
                  } catch (e) {
                    console.error('History API error:', e);
                  }
                }
              }, 100);
            } else {
              console.error('Invalid data format');
              alert('❌ Invalid share link. Please check the link and try again.');
            }
          }
        } catch (error) {
          console.error('Error loading shared data:', error);
          alert('❌ Error loading shared data: ' + error.message);
        }
      };

      $("#addUserForm").submit(e => {
        e.preventDefault();
        const userName = $("#userName").val().trim();
        if (!userName) {
          alert('Please enter a user name.');
          return;
        }
        if (users.includes(userName)) {
          alert('User already exists!');
          return;
        }
        users.push(userName);
        $("#userName").val("");
        saveToLocalStorage();
        updateUI();
      });

      $(document).on("click", ".edit-user", function () {
        const index = $(this).data("index");
        const userName = users[index];
        const newUserName = prompt("Edit user name:", userName);
        if (newUserName && newUserName.trim() && newUserName !== userName) {
          if (users.includes(newUserName)) {
            alert('A user with this name already exists!');
            return;
          }
          users[index] = newUserName.trim();
          expenses.forEach(expense => {
            if (expense.paidBy === userName) expense.paidBy = newUserName.trim();
            expense.splitAmong = expense.splitAmong.map(person => person === userName ? newUserName.trim() : person);
          });
          saveToLocalStorage();
          updateUI();
        }
      });

      $(document).on("click", ".delete-user", function () {
        const index = $(this).data("index");
        const userName = users[index];
        const userExpenses = expenses.filter(e => e.paidBy === userName || e.splitAmong.includes(userName));
        if (userExpenses.length > 0) {
          if (!confirm(`${userName} is part of ${userExpenses.length} expense(s). Deleting will remove them from all expenses. Continue?`)) {
            return;
          }
        }
        if (confirm(`Are you sure you want to delete user: ${userName}?`)) {
          users.splice(index, 1);
          // Remove user from expenses
          expenses.forEach((expense, i) => {
            expense.splitAmong = expense.splitAmong.filter(person => person !== userName);
            // If no one left to split among, or payer was deleted, remove expense
            if (expense.splitAmong.length === 0 || expense.paidBy === userName) {
              expenses.splice(i, 1);
            }
          });
          saveToLocalStorage();
          updateUI();
        }
      });

      $("#addExpenseForm").submit(e => {
        e.preventDefault();
        const description = $("#expenseDescription").val().trim();
        const amount = parseFloat($("#expenseAmount").val().trim());
        const paidBy = $("#expensePaidBy").val();
        const splitAmong = $("#expenseSplitAmong").val();

        if (!description) {
          alert('Please enter an expense description.');
          return;
        }
        if (!amount || amount <= 0) {
          alert('Please enter a valid amount greater than 0.');
          return;
        }
        if (!paidBy) {
          alert('Please select who paid for this expense.');
          return;
        }
        if (!splitAmong || splitAmong.length === 0) {
          alert('Please select at least one person to split the expense among.');
          return;
        }

        expenses.push({
          description,
          amount,
          paidBy,
          splitAmong
        });
        
        // Reset form completely
        $("#expenseDescription").val("");
        $("#expenseAmount").val("");
        $("#expensePaidBy").val("");
        $("#expenseSplitAmong").val([]);
        
        saveToLocalStorage();
        updateUI();
      });

      const populateDropdowns = () => {
        const paidByValue = $("#expensePaidBy").val();
        const splitAmongValue = $("#expenseSplitAmong").val() || [];
        
        $("#expensePaidBy").empty().append('<option value="" disabled selected>Paid by</option>');
        $("#expenseSplitAmong").empty();
        
        users.forEach(user => {
          $("#expensePaidBy").append(`<option value='${user}'>${user}</option>`);
          $("#expenseSplitAmong").append(`<option value='${user}'>${user}</option>`);
        });
        
        // Restore selections if still valid
        if (users.includes(paidByValue)) $("#expensePaidBy").val(paidByValue);
        const validSplits = splitAmongValue.filter(u => users.includes(u));
        if (validSplits.length > 0) $("#expenseSplitAmong").val(validSplits);
      };

      $(document).on("click", ".edit-expense", function () {
        const index = $(this).closest("tr").data("index");
        const expense = expenses[index];

        $("#expenseDescription").val(expense.description);
        $("#expenseAmount").val(expense.amount);
        $("#expensePaidBy").val(expense.paidBy);
        $("#expenseSplitAmong").val(expense.splitAmong);

        expenses.splice(index, 1);
        saveToLocalStorage();
        updateUI();
        
        // Scroll to form
        $('html, body').animate({scrollTop: $('#addExpenseForm').offset().top - 100}, 500);
      });

      $(document).on("click", ".delete-expense", function () {
        const index = $(this).closest("tr").data("index");
        if (confirm('Are you sure you want to delete this expense?')) {
          expenses.splice(index, 1);
          saveToLocalStorage();
          updateUI();
        }
      });

      // Share button handlers
      $("#shareButton").click(generateShareLink);
      $("#copyCodeButton").click(copyShareCode);
      $("#importCodeButton").click(importShareCode);
      $("#exportButton").click(exportToFile);
      $("#importButton").click(() => $("#fileInput").click());
      $("#fileInput").change(importFromFile);

      // Load shared data on page load
      loadSharedData();
      updateUI();
    });
  </script>
</body>
</html>